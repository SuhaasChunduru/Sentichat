<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SentiChat Bot</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;700&family=Lobster&display=swap');

        :root {
            --bg-gradient: linear-gradient(-135deg, #000000 0%, #d9e2ec 100%);
            --sidebar-gradient: linear-gradient(-35deg, #8badcf 0%, #ffffff 100%);
            --header-gradient: linear-gradient(135deg, #74c0fc 0%, #4dabf7 100%);
            --send-btn-gradient: linear-gradient(135deg, #74c0fc, #4dabf7);
            --send-btn-hover: linear-gradient(135deg, #4dabf7, #339af0);
            --outgoing-gradient: linear-gradient(135deg, #51cf66, #40c057);
            --bubble-neutral: linear-gradient(135deg, #e9ecef, #dee2e6);
            --text-color: #000000;
            --chat-bg: #f8f9fa;
            --input-bg: #f8f9fa;
            --input-text: #333333;
            --container-bg: #ffffff;
            --border-color: #ced4da;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg-gradient: linear-gradient(-135deg, #1a1a1a 0%, #4a5e6e 100%);
            --sidebar-gradient: linear-gradient(-35deg, #4a6a8a 0%, #2a2a2a 100%);
            --text-color: #e9ecef;
            --chat-bg: #2a2a2a;
            --input-bg: #3a3a3a;
            --input-text: #e9ecef;
            --container-bg: #1e1e1e;
            --border-color: #4a4a4a;
            --shadow-color: rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            height: 100vh;
            background: var(--bg-gradient);
            overflow: hidden;
            color: var(--text-color);
        }

        .app-container {
            max-width: 1200px;
            height: calc(100vh - 40px);
            margin: 20px auto;
            display: flex;
            background: var(--container-bg);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px var(--shadow-color);
        }

        .sidebar {
            width: 250px;
            background: var(--sidebar-gradient);
            padding: 20px;
            border-right: 1px solid #16416d;
            overflow-y: auto;
        }

        .sidebar-header {
            font-size: 1.5rem;
            font-weight: 500;
            color: #2f73b6;
            margin-bottom: 20px;
        }

        .friend-list {
            list-style: none;
        }

        .friend-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            display: flex;
            align-items: center;
            background: #9bc0e4;
        }

        .friend-item:hover, .friend-item.active, .friend-item:focus {
            background: #ced4da;
            transform: scale(1.02);
            outline: none;
        }

        .friend-item:focus {
            box-shadow: 0 0 0 2px #4dabf7;
        }

        .friend-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #74c0fc, #4dabf7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: 500;
            box-shadow: 0 2px 5px var(--shadow-color);
        }

        .chat-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: var(--header-gradient);
            color: #ffffff;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #4dabf7;
        }

        .app-title {
            font-family: 'Lobster', cursive;
            font-size: 2.2rem;
            font-weight: 400;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);
            position: relative;
            animation: bubbleGlow 2s infinite alternate;
        }

        @keyframes bubbleGlow {
            0% { text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5); }
            100% { text-shadow: 0 0 15px rgba(255, 255, 255, 1), 0 0 25px rgba(255, 255, 255, 0.7); }
        }

        .mood-indicator {
            font-size: 0.9rem;
            padding: 6px 12px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: #ffffff;
        }

        .clear-btn, .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: #ffffff;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            transition: background 0.3s;
            margin-left: 10px;
        }

        .clear-btn:hover, .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--chat-bg);
            overflow: hidden;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .message-container {
            display: flex;
            margin-bottom: 20px;
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message-outgoing-container {
            flex-direction: row-reverse;
            align-self: flex-end;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            margin-right: 12px;
            background: linear-gradient(135deg, #74c0fc, #4dabf7);
            box-shadow: 0 2px 5px var(--shadow-color);
        }

        .message-outgoing-container .message-avatar {
            margin-right: 0;
            margin-left: 12px;
            background: var(--outgoing-gradient);
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 18px;
            border-radius: 20px;
            font-size: 1rem;
            box-shadow: 0 2px 5px var(--shadow-color);
            transition: background 0.3s ease;
        }

        .message-outgoing-container .message-bubble {
            background: var(--outgoing-gradient);
            color: #ffffff;
        }

        .message-time {
            font-size: 0.7rem;
            margin-top: 5px;
            opacity: 0.7;
            text-align: right;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 10px;
            opacity: 0.7;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: #4dabf7;
            border-radius: 50%;
            margin: 0 4px;
            animation: bounce 1.2s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) { animation-delay: -0.3s; }
        .typing-dot:nth-child(3) { animation-delay: -0.15s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .chat-input {
            padding: 15px;
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            background: var(--container-bg);
        }

        .input-field {
            flex: 1;
            padding: 12px 20px;
            border: 1px solid var(--border-color);
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            transition: border 0.3s;
            background: var(--input-bg);
            color: var(--input-text);
            box-shadow: 0 2px 5px var(--shadow-color);
        }

        .input-field:focus {
            border-color: #4dabf7;
        }

        .send-btn {
            background: var(--send-btn-gradient);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            margin-left: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, background 0.3s;
            box-shadow: 0 2px 5px var(--shadow-color);
            position: relative;
        }

        .send-btn:hover {
            background: var(--send-btn-hover);
        }

        .send-btn:active {
            transform: scale(0.9);
        }

        .send-btn::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
        }

        .send-btn:active::after {
            opacity: 1;
            transform: scale(1.5);
        }

        .send-btn i {
            font-size: 1.2rem;
        }

        @media (prefers-reduced-motion: reduce) {
            .friend-item, .send-btn, .message-container, .typing-dot {
                animation: none;
                transition: none;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="sidebar" role="navigation" aria-label="Friend list">
            <div class="sidebar-header">Friends</div>
            <ul class="friend-list" id="friendList" role="listbox" tabindex="0">
                <!-- Friends will be added here dynamically -->
            </ul>
        </div>
        <div class="chat-section">
            <div class="header">
                <div>
                    <h1 class="app-title">SentiChat</h1>
                </div>
                <div>
                    <span class="mood-indicator" id="moodIndicator" aria-live="polite">Mood: Neutral 😐</span>
                    <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="clear-btn" id="clearBtn" aria-label="Clear chat">
                        <i class="fas fa-trash-alt"></i> Clear
                    </button>
                </div>
            </div>
            <div class="chat-area" id="chatArea" role="log" aria-label="Chat messages">
                <div class="chat-messages" id="chatMessages">
                    <!-- Messages will be added here dynamically -->
                </div>
                <div class="chat-input">
                    <input type="text" class="input-field" id="messageInput" placeholder="Type your message..." aria-label="Message input">
                    <button class="send-btn" id="sendBtn" aria-label="Send message">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const currentUser = { id: 0, initial: 'Y', name: 'You' };
        const personas = {
            Alex: { name: 'Alex', initial: 'A', tone: 'Hey there! I’m Alex, your chill buddy who’s always up for a chat.' },
            Emma: { name: 'Emma', initial: 'E', tone: 'Hi! I’m Emma, your cheerful friend who loves a good convo!' },
            Sam: { name: 'Sam', initial: 'S', tone: 'Yo! I’m Sam, your laid-back pal ready to talk about anything.' }
        };
        let currentPersona = personas.Alex;

        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const clearBtn = document.getElementById('clearBtn');
        const moodIndicator = document.getElementById('moodIndicator');
        const friendList = document.getElementById('friendList');
        const themeToggle = document.getElementById('themeToggle');

        const sentimentWords = {
            positive: [
                'happy', 'great', 'excellent', 'fantastic', 'awesome', 'good',
                'wonderful', 'amazing', 'love', 'best', 'beautiful', 'excited',
                'glad', 'joy', 'pleased', 'smile', 'laugh', 'fun', 'perfect',
                'brilliant', 'outstanding', 'terrific', 'superb', 'cool',
                '😊', '😃', '😄', '😁', '🙂', '😀', '😌', '😍', '🥰', '❤️'
            ],
            negative: [
                'sad', 'bad', 'terrible', 'awful', 'horrible', 'poor', 'hurt',
                'disappointed', 'upset', 'angry', 'hate', 'dislike', 'fail',
                'worst', 'sorry', 'annoyed', 'frustrated', 'miserable', 'unhappy',
                'unfortunate', 'regret', 'depressed', 'gloomy', 'painful', 'down',
                '😢', '😭', '😡', '😠', '😞', '😔', '😣', '😖', '😒', '🥺'
            ]
        };

        let moodScore = 0;

        // Theme handling
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', currentTheme);
            themeToggle.innerHTML = currentTheme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
            localStorage.setItem('theme', currentTheme);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            themeToggle.innerHTML = savedTheme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        }

        themeToggle.addEventListener('click', toggleTheme);

        function getCurrentTime() {
            const now = new Date();
            return now.getHours().toString().padStart(2, '0') + ':' +
                   now.getMinutes().toString().padStart(2, '0');
        }

        function analyzeSentiment(text) {
            text = text.toLowerCase();
            let positiveCount = 0;
            let negativeCount = 0;
            let specificMood = null;

            sentimentWords.positive.forEach(word => {
                const regex = new RegExp('\\b' + word + '\\b', 'g');
                const matches = text.match(regex);
                if (matches) {
                    positiveCount += matches.length;
                    if (['happy', 'great', 'awesome', 'good', 'smile', 'love'].includes(word)) {
                        specificMood = 'happy';
                    }
                }
            });

            sentimentWords.negative.forEach(word => {
                const regex = new RegExp('\\b' + word + '\\b', 'g');
                const matches = text.match(regex);
                if (matches) {
                    negativeCount += matches.length;
                    if (['sad', 'hurt', 'depressed', 'unhappy', 'sorry'].includes(word)) {
                        specificMood = 'sad';
                    }
                }
            });

            if (positiveCount > negativeCount) return { sentiment: 'positive', specificMood };
            if (negativeCount > positiveCount) return { sentiment: 'negative', specificMood };
            return { sentiment: 'neutral', specificMood };
        }

        function updateMood(text) {
            const { sentiment, specificMood } = analyzeSentiment(text);
            if (sentiment === 'positive') {
                moodScore = Math.min(moodScore + 1, 10);
            } else if (sentiment === 'negative') {
                moodScore = Math.max(moodScore - 1, -10);
            }

            let moodText, emoji, bubbleColor;
            if (specificMood === 'happy' || moodScore > 3) {
                moodText = 'Mood: Happy';
                emoji = '😊';
                bubbleColor = 'linear-gradient(135deg, #94d82d, #74b816)';
            } else if (specificMood === 'sad' || moodScore < -3) {
                moodText = 'Mood: Sad';
                emoji = '😢';
                bubbleColor = 'linear-gradient(135deg, #ff8787, #ff6b6b)';
            } else {
                moodText = 'Mood: Neutral';
                emoji = '😐';
                bubbleColor = 'var(--bubble-neutral)';
            }

            moodIndicator.textContent = `${moodText} ${emoji}`;
            document.querySelectorAll('.message-bubble:not(.message-outgoing-container .message-bubble)').forEach(bubble => {
                bubble.style.background = bubbleColor;
                bubble.style.color = document.documentElement.getAttribute('data-theme') === 'dark' ? '#e9ecef' : '#333333';
            });
        }

        function addMessage(text, isOutgoing = false, userName = null) {
            const messageContainer = document.createElement('div');
            messageContainer.className = `message-container ${isOutgoing ? 'message-outgoing-container' : 'message-incoming-container'}`;
            messageContainer.setAttribute('aria-live', 'polite');

            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = isOutgoing ? currentUser.initial : currentPersona.initial;
            avatar.setAttribute('aria-hidden', 'true');
            messageContainer.appendChild(avatar);

            const messageBubble = document.createElement('div');
            messageBubble.className = 'message-bubble';

            if (userName) {
                const senderName = document.createElement('div');
                senderName.className = 'message-sender';
                senderName.textContent = userName;
                messageBubble.appendChild(senderName);
            }

            const contentDiv = document.createElement('div');
            contentDiv.innerHTML = marked.parse(text);
            messageBubble.appendChild(contentDiv);

            const timeDiv = document.createElement('div');
            timeDiv.className = 'message-time';
            timeDiv.textContent = getCurrentTime();
            messageBubble.appendChild(timeDiv);

            messageContainer.appendChild(messageBubble);
            chatMessages.appendChild(messageContainer);

            updateMood(text);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const typingContainer = document.createElement('div');
            typingContainer.className = 'message-container message-incoming-container typing-indicator';
            typingContainer.id = 'typingIndicator';
            typingContainer.setAttribute('aria-live', 'polite');
            typingContainer.setAttribute('aria-label', `${currentPersona.name} is typing`);

            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = currentPersona.initial;
            avatar.setAttribute('aria-hidden', 'true');
            typingContainer.appendChild(avatar);

            typingContainer.innerHTML += '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
            chatMessages.appendChild(typingContainer);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return typingContainer;
        }

        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                chatMessages.removeChild(typingIndicator);
            }
        }

        async function sendMessage() {
            const input = messageInput.value.trim();
            if (!input) return;

            addMessage(input, true, currentUser.name);
            messageInput.value = '';
            messageInput.focus();

            const typingIndicator = showTypingIndicator();

            // For testing without a valid API key, enable this mock response
            /*
            await new Promise(resolve => setTimeout(resolve, 1000));
            removeTypingIndicator();
            addMessage(`Hey ${currentUser.name}! ${currentPersona.name} says: Got your message - "${input}"! What's next?`, false, currentPersona.name);
            return;
            */

            try {
                const response = await fetch(
                    'https://openrouter.ai/api/v1/chat/completions',
                    {
                        method: 'POST',
                        headers: {
                            'Authorization': 'Bearer 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', // Replace with your valid API key
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            model: 'gpt-3.5-turbo', // Fallback to a widely supported model
                            messages: [
                                { role: 'system', content: `You are ${currentPersona.name}, a friendly and casual person. Respond in a conversational, human-like tone: "${currentPersona.tone}"` },
                                { role: 'user', content: input }
                            ]
                        }),
                    }
                );

                console.log('Response Status:', response.status, response.statusText);

                const data = await response.json();
                console.log('Full Response:', data);

                if (!response.ok) {
                    throw new Error(data.error?.message || 'API request failed');
                }

                removeTypingIndicator();
                const responseText = data.choices?.[0]?.message?.content || 'No response received.';
                addMessage(responseText, false, currentPersona.name);

            } catch (error) {
                removeTypingIndicator();
                const errorMessage = `Oops, something went wrong! ${error.message}`;
                console.error('Error:', error);
                addMessage(errorMessage, false, currentPersona.name);
            }
        }

        function clearChat() {
            while (chatMessages.firstChild) {
                chatMessages.removeChild(chatMessages.firstChild);
            }
            moodScore = 0;
            updateMood('');
            addMessage(`Hey! Chat’s all fresh now. What’s on your mind?`, false, currentPersona.name);
            messageInput.focus();
        }

        function switchPersona(personaName) {
            currentPersona = personas[personaName];
            document.querySelectorAll('.friend-item').forEach(item => {
                item.classList.toggle('active', item.dataset.persona === personaName);
                item.setAttribute('aria-selected', item.dataset.persona === personaName);
            });
            clearChat();
        }

        function populateFriendList() {
            Object.keys(personas).forEach(personaName => {
                const friendItem = document.createElement('li');
                friendItem.className = 'friend-item';
                friendItem.dataset.persona = personaName;
                friendItem.setAttribute('role', 'option');
                friendItem.setAttribute('aria-selected', personaName === 'Alex');
                friendItem.tabIndex = -1;
                friendItem.innerHTML = `
                    <div class="friend-avatar">${personas[personaName].initial}</div>
                    ${personas[personaName].name}
                `;
                friendItem.addEventListener('click', () => switchPersona(personaName));
                friendList.appendChild(friendItem);
            });
            friendList.querySelector('.friend-item[data-persona="Alex"]').classList.add('active');
        }

        // Keyboard navigation for friend list
        friendList.addEventListener('keydown', (e) => {
            const items = Array.from(friendList.querySelectorAll('.friend-item'));
            const current = document.activeElement;
            let index = items.indexOf(current);

            if (e.key === 'ArrowDown') {
                e.preventDefault();
                index = (index + 1) % items.length;
                items[index].focus();
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                index = (index - 1 + items.length) % items.length;
                items[index].focus();
            } else if (e.key === 'Enter' && current.classList.contains('friend-item')) {
                e.preventDefault();
                switchPersona(current.dataset.persona);
            }
        });

        sendBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                sendMessage();
            }
        });

        clearBtn.addEventListener('click', clearChat);

        populateFriendList();
        addMessage(`Hey! I’m ${currentPersona.name}. So glad you’re here—what’s up?`, false, currentPersona.name);
        loadTheme();
    </script>
</body>
</html>